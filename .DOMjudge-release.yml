test_sign:
  stage: test
  rules:
    - if: '$TRIGGER_JOB == "tarball"'
  script:
    - >
      for POST in '' '.sha256sum' '.asc'; do
        wget "https://www.domjudge.org/releases/domjudge-$DOMJUDGE_VERSION.tar.gz$POST"
      done
      gpg "domjudge-$DOMJUDGE_VERSION.tar.gz.asc"
      sha256sum -c "domjudge-$DOMJUDGE_VERSION.tar.gz.sha256sum"

test_tar:
  stage: test
  rules:
    - if: '$TRIGGER_JOB == "tarball"'
  script:
    - wget "https://www.domjudge.org/releases/domjudge-$DOMJUDGE_VERSION.tar.gz"
    - tar xvf domjudge-$DOMJUDGE_VERSION.tar.gz
    - ./configure
    - make all

.debs_template: &debs
  stage: test
  rules:
    - if: '$TRIGGER_JOB == "deb"'
  parallel:
    matrix:
      - PACKAGE: ["doc","domserver","judgehost"]
  script:
    - curl -o - https://www.domjudge.org/repokey.asc | sudo apt-key add -
    - echo "deb     https://domjudge.org/debian unstable/" >> /etc/apt/sources.list.d/tmp
    - apt update; apt install domserver-"$PACKAGE"

debian-debs-stab:
  <<: *debs
  image: debian/stable

debian-debs-oldstab:
  <<: *debs
  image: debian/oldstable

ubuntu-debs-latest:
  <<: *debs
  image: ubuntu/latest

ubuntu-debs-rolling:
  <<: *debs
  image: debian/rolling

